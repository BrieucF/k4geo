<lccdd xmlns:compact="http://www.lcsim.org/schemas/compact/1.0" 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    xs:noNamespaceSchemaLocation="http://www.lcsim.org/schemas/compact/1.0/compact.xsd">

    <info name="ILD_o1_v05"
        title="ILD Mokka model used for the DBD - ported to DD4hep"
        author="F. Gaede"
        url="http://ilcsoft.desy.de"
        status="experimantal"
        version="$Id:$">
        <comment>ILD Mokka model used for the DBD - ported to DD4hep </comment>        
    </info>
  
    <includes>
        <gdmlFile  ref="elements.xml"/>
        <gdmlFile  ref="materials.xml"/>
        <!--pyBuilder ref="../drivers"/-->
    </includes>
  
    <define>
        <constant name="world_side"             value="10*m"/>
        <constant name="world_x"                value="world_side/2"/>
        <constant name="world_y"                value="world_side/2"/>
        <constant name="world_z"                value="world_side/2"/>        

	<!-- global parameters from Mokka model ILD_o1_v05 -->
	<constant name="BCal_PairMonitor" value="1"/>
	<constant name="BCal_CutOutSpanningPhi" value="40*deg"/>
	<constant name="BCal_TubeIncomingRadius" value="15*mm"/>
	<constant name="BCal_dAbsorber" value="3.5*mm"/>
	<constant name="BCal_dGraphite" value="100*mm"/>
	<constant name="BCal_nLayers" value="30"/>
	<constant name="BCal_nWafers" value="8"/>
	<constant name="BCal_rInner" value="20*mm"/>
	<constant name="BCal_rOuter" value="150*mm"/>
	<constant name="BCal_rSegmentation" value="8"/>
	<constant name="Coil_Yoke_radial_clearance" value="250"/>
	<constant name="Coil_extra_size" value="1522"/>
	<constant name="Ecal_Alveolus_Air_Gap" value="0.5"/>
	<constant name="Ecal_Barrel_halfZ" value="2350"/>
	<constant name="Ecal_Si_thickness" value=".5"/>
	<constant name="Ecal_Slab_H_fiber_thickness" value="0.55"/>
	<constant name="Ecal_Slab_PCB_thickness" value="0.8"/>
	<constant name="Ecal_Slab_copper_thickness" value="0.4"/>
	<constant name="Ecal_Slab_glue_gap" value="0.1"/>
	<constant name="Ecal_Slab_ground_thickness" value="0.1"/>
	<constant name="Ecal_Slab_shielding" value="0.1"/>
	<constant name="Ecal_Tpc_gap" value="35"/>
	<constant name="Ecal_barrel_number_of_towers" value="5"/>
	<constant name="Ecal_cells_size" value="4.9"/>
	<constant name="Ecal_endcap_center_box_size" value="800.0"/>
	<constant name="Ecal_endcap_extra_size" value="60.8"/>
	<constant name="Ecal_endcap_zmin" value="2450.0"/>
	<constant name="Ecal_fiber_thickness" value=".15"/>
	<constant name="Ecal_front_face_thickness" value="2"/>
	<constant name="Ecal_guard_ring_size" value="0.5"/>
	<constant name="Ecal_lateral_face_thickness" value="2"/>
	<constant name="Ecal_nlayers2" value="9"/>
	<constant name="Ecal_support_thickness" value="9.3"/>
	<constant name="Field_nominal_value" value="3.5"/>
	<constant name="Hcal_Coil_additional_gap" value="29.5"/>
	<constant name="Hcal_Ecal_gap" value="30"/>
	<constant name="Hcal_apply_Birks_law" value="1"/>
	<constant name="Hcal_back_plate_thickness" value="15"/>
	<constant name="Hcal_cells_size" value="30"/>
	<constant name="Hcal_endcap_center_box_size" value="700.0"/>
	<constant name="Hcal_endcap_ecal_gap" value="15"/>
	<constant name="Hcal_endcap_nlayers" value="48"/>
	<!--constant name="Hcal_endcap_radiator_material" value="Iron"/-->
	<constant name="Hcal_endcap_radiator_thickness" value="20"/>
	<constant name="Hcal_endcap_sensitive_center_box" value="0.0"/>
	<constant name="Hcal_endcap_zmin" value="2670.7"/>
	<constant name="Hcal_fiber_gap" value="2.7"/>
	<constant name="Hcal_lateral_structure_thickness" value="15"/>
	<constant name="Hcal_layer_air_gap" value="2"/>
	<constant name="Hcal_layer_support_length" value="0"/>
	<constant name="Hcal_middle_stave_gaps" value="10"/>
	<constant name="Hcal_modules_gap" value="0"/>
	<constant name="Hcal_nlayers" value="48"/>
	<constant name="Hcal_radiator_thickness" value="20.0"/>
	<!--constant name="Hcal_sensitive_model" value="scintillator"/-->
	<constant name="Hcal_stave_gaps" value="10"/>
	<constant name="ILC_Main_Crossing_Angle" value="14*mrad"/>
	<constant name="LHcal_BCal_clearance" value="390*mm"/>
	<constant name="LHcal_zend" value="3085*mm"/>
	<constant name="Lcal_inner_radius" value="80.0"/>
	<constant name="Lcal_outer_radius" value="195.2"/>
	<constant name="Lcal_z_begin" value="2505.0"/>
	<constant name="Lcal_z_thickness" value="135.6"/>
	<constant name="SIT1_Half_Length_Z" value="384.2"/>
	<constant name="SIT1_Radius" value="179.232"/>
	<constant name="SIT2_Half_Length_Z" value="672.35"/>
	<constant name="SIT2_Radius" value="272.363"/>

	<constant name="TPC_Ecal_Hcal_barrel_halfZ" value="2350*mm"/>
	<constant name="TPC_inner_radius" value="329*mm"/>
	<constant name="TPC_outer_radius" value="1808*mm"/>

	<constant name="TUBE_IPOuterBulge_end_radius" value="184"/>
	<constant name="TUBE_IPOuterBulge_end_z" value="2364.5"/>
	<constant name="TUBE_IPOuterTube_end_radius" value="24"/>
	<constant name="TUBE_IPOuterTube_end_z" value="230"/>
	<constant name="TUBE_IPOuterTube_start_radius" value="24"/>
	<constant name="TUBE_IPOuterTube_start_z" value="150"/>
	<constant name="TUBE_crossing_angle" value="14"/>
	<constant name="TUBE_opening_angle" value="0.07876"/>
	<constant name="VXD_active_silicon_thickness" value="0.05*mm"/>

	<constant name="VXD_inner_radius" value="16*mm"/>
	<constant name="VXD_length_r1" value="62.5*mm"/>
	<constant name="VXD_length_r3" value="125*mm"/>
	<constant name="VXD_radius_r1" value="16*mm"/>
	<constant name="VXD_radius_r3" value="37*mm"/>
	<constant name="VXD_radius_r5" value="58*mm"/>
	<constant name="VXD_side_band_electronics_width" value="0.5*mm"/>
	<!--constant name="VXD_support_ladder_material" value="graphite"/-->
	<constant name="VXD_support_ladder_thickness" value="0.134*mm"/>

	<constant name="Yoke_endcap_inner_radius" value="300"/>
	<constant name="Yoke_thickness" value="2550"/>

	<!-- FIXME: string constants not supported  !!!??? -->


	<comment>Dummy Parameters for the BeamCal</comment>
	<constant name="BeamCal_rmin"  value="30*mm"/>
	<constant name="BeamCal_rmax"  value="15*cm"/>
	<constant name="BeamCal_zmin"  value="3.3*m"/>
	<!-- <constant name="CrossingAngle"  value="14*mrad"/> -->

    </define>

  
    <!--limits>
        <limitset name="cal_limits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>
        <limitset name="TPC_limits">
            <limit name="step_length_max" particles="*" value="10.0" unit="mm" />
        </limitset>
        <limitset name="Tracker_limits">
            <limit name="step_length_max" particles="*" value="5.0" unit="mm" />
        </limitset>
    </limits-->

    <display>
      <!-- fixme:  white comes out as red !!!???? |  vis name="WhiteVis"         alpha="0.0" r="1.0" g="1.0"  b="1.0"   showDaughters="true"  visible="true"/ --> 
      <vis name="WhiteVis"         alpha="0.0" r=".96" g=".96"  b=".96"   showDaughters="true"  visible="true"/>

      <vis name="Invisible"         alpha="0.0" r="0" g="0"  b="0"   showDaughters="false"  visible="false"/>

      <vis name="RedVis"           alpha="1.0" r="1.0" g="0.0"  b="0.0"   showDaughters="true"  visible="true"/>
      <vis name="GreenVis"         alpha="1.0" r="0.0" g="1.0"  b="0.0"   showDaughters="true"  visible="true"/>
      <vis name="BlueVis"          alpha="1.0" r="0.0" g="0.0"  b="1.0"   showDaughters="true"  visible="true"/>
      <vis name="CyanVis"          alpha="1.0" r="0.0" g="1.0"  b="1.0"   showDaughters="true"  visible="true"/>
      <vis name="MagentaVis"       alpha="1.0" r="1.0" g="0.0"  b="1.0"   showDaughters="true"  visible="true"/>
      <vis name="YellowVis"        alpha="1.0" r="1.0" g="1.0"  b="0.0"   showDaughters="true"  visible="true"/>
      <vis name="BlackVis"         alpha="1.0" r="0.0" g="0.0"  b="0.0"   showDaughters="true"  visible="true"/>
      <vis name="GrayVis"          alpha="1.0" r="0.5" g="0.5"  b="0.5"   showDaughters="true"  visible="true"/>

      <vis name="TPCVis"        alpha="0.1" r="0" g="0"  b="0"   showDaughters="true"  visible="true"/>
      <vis name="TPCMotherVis"  alpha="0.1" r="0.9" g="0.9"  b="0.9"   showDaughters="true"  visible="false"/>

      <vis name="VXDVis"        alpha="0.1" r="0.1" g=".5"  b=".5"   showDaughters="true"  visible="true"/>
      <vis name="VXDLayerVis"   alpha="1.0" r="0.1" g=".5"  b=".5"   showDaughters="true"  visible="true"/>
      <vis name="VXDSupportVis" alpha="1.0" r="0.0" g="1.0" b="0.0"  showDaughters="true" visible="true"/>

      <vis name="MyBeamCalVis"    r="1.0" g="1.0"  b="1.0" alpha="0.5" showDaughters="true"  visible="false"/>
      <vis name="BCLayerVis1"       r="1.0" g="0.0"  b="0.0" alpha="1" showDaughters="true"  visible="true"/>
      <vis name="BCLayerVis2"       r="0.0" g="1.0"  b="0.0" alpha="1" showDaughters="true"  visible="true"/>
      <vis name="BCLayerVis3"       r="0.0" g="0.0"  b="1.0" alpha="1" showDaughters="true"  visible="true"/>
      <vis name="BCLayerVis4"       r="1.0" g="0.0"  b="1.0" alpha="1" showDaughters="true"  visible="true"/>

    </display>

    <materials>
      <material name="TPC_endplate_mix">
	<!--D value="1.7" unit="g/cm3"/-->
	<composite n="74" ref="G4_AIR"/>
	<composite n="12" ref="g10"/>
	<composite n="14" ref="G4_Al"/>
      </material>      
    </materials>

    <detectors>
        <comment>Trackers</comment>

        <detector name="VTX" type="VXD04" vis="VXDVis" id="1" limits="Tracker_limits" readout="VXDCollection" insideTrackingVolume="true">
	  
          <tubs rmin="0*mm" rmax="180*mm" zhalf="380.*mm" name="envelope"/>

	  <!-- database : TMP_DB10 -->
	  <!-- SQL command: "select * from layers_common_parameters;"  -->
	  <layers_common_parameters id="1" electronics_structure_thickness="0.1*mm" active_silicon_thickness="0.05*mm" support_structure_radial_thickness="0.49392*mm" end_electronics_half_z="5*mm" 
				    strip_final_beampipe_radious="24.3*mm"	side_band_electronics_option="1" end_ladd_electronics_option="1" side_band_electronics_width="0.5*mm" 
				    side_band_electronics_thickness="0.05*mm" active_side_band_electronics_option="0" layer_gap="2*mm" flex_cable_material="G4_KAPTON" flex_cable_thickness="0.05*mm"
				    foam_spacer_material="SiC_foam" foam_spacer_thickness="0.94*mm" metal_traces_material="G4_Al" metal_traces_thickness="0.01*mm" cool_pipe_material="titanium" 
				    cool_pipe_inner_radius="0.75*mm" cool_pipe_outer_radius="1*mm" external_kapton_thickness="0.05*mm" external_metal_thickness="0.009*mm"  />
	  <!-- SQL command: "SELECT * FROM cryostat;"  -->
	  <cryostat id="1" alu_skin_inner_radious="100*mm" alu_skin_tickness="0.5*mm" foam_inner_radious="90*mm" foam_tickness="10*mm" foam_half_z="166.6*mm" endplate_inner_radious="24.2*mm" 
		    cryostat_option="1" cryostat_apperture="30*mm" cryostat_apperture_radius="1.5*mm"  />
	  <!-- SQL command: "select * from support_shell;"  -->
	  <support_shell id="0" inner_radious="65*mm" half_z="145*mm" thickess="0.49392*mm" endplate_inner_radious="30*mm" endplate_inner_radius_L1="15.7*mm" endplate_outer_radius_L1="20*mm" 
			 offset_ladder_block="0.28224*mm" beryllium_ladder_block_length="5*mm" beryllium_ladder_block_thickness="0.25*mm" shell_endplate_thickness="2*mm" forward_shell_half_z="6.5*mm"  />
	  <!-- SQL command: "select * from layer;"  -->
	  <layer id="1" layer_radius="VXD_radius_r1" ladder_length="VXD_length_r1" ladder_width="5.5*mm" nb_ladder="10" ladder_gap="0" strip_line_final_z="150*mm" end_electronics_width="5.5*mm" 
		 initial_kapton_striplines_thickness="0.04566*mm" final_kapton_striplines_thickness="0.02435*mm" initial_metal_striplines_thickness="0.00806*mm" 
		 final_metal_striplines_thickness="0.0043*mm" support_width="4.5*mm"  />
	  <layer id="2" layer_radius="VXD_radius_r1" ladder_length="VXD_length_r1" ladder_width="5.5*mm" nb_ladder="10" ladder_gap="0" strip_line_final_z="150*mm" end_electronics_width="5.5*mm" 
		 initial_kapton_striplines_thickness="0.04566*mm" final_kapton_striplines_thickness="0.02435*mm" initial_metal_striplines_thickness="0.00806*mm" 
		 final_metal_striplines_thickness="0.0043*mm" support_width="4.5*mm"  />
	  <layer id="3" layer_radius="VXD_radius_r3" ladder_length="VXD_length_r3" ladder_width="11*mm" nb_ladder="11" ladder_gap="0*mm" strip_line_final_z="150*mm" end_electronics_width="11*mm" 
		 initial_kapton_striplines_thickness="0.04102*mm" final_kapton_striplines_thickness="0.05059*mm" initial_metal_striplines_thickness="0.00724*mm" 
		 final_metal_striplines_thickness="0.00893*mm" support_width="10*mm"  />
	  <layer id="4" layer_radius="VXD_radius_r3" ladder_length="VXD_length_r3" ladder_width="11*mm" nb_ladder="11" ladder_gap="0*mm" strip_line_final_z="150*mm" end_electronics_width="11*mm" 
		 initial_kapton_striplines_thickness="0.04102*mm" final_kapton_striplines_thickness="0.05059*mm" initial_metal_striplines_thickness="0.00724*mm" 
		 final_metal_striplines_thickness="0.00893*mm" support_width="10*mm"  />
	  <layer id="5" layer_radius="VXD_radius_r5" ladder_length="VXD_length_r3" ladder_width="11*mm" nb_ladder="17" ladder_gap="0*mm" strip_line_final_z="150*mm" end_electronics_width="11*mm" 
		 initial_kapton_striplines_thickness="0.04044*mm" final_kapton_striplines_thickness="0.07819*mm" initial_metal_striplines_thickness="0.00714*mm" 
		 final_metal_striplines_thickness="0.0138*mm" support_width="10*mm"  />
	  <layer id="6" layer_radius="VXD_radius_r5" ladder_length="VXD_length_r3" ladder_width="11*mm" nb_ladder="17" ladder_gap="0*mm" strip_line_final_z="150*mm" end_electronics_width="11*mm" 
		 initial_kapton_striplines_thickness="0.04044*mm" final_kapton_striplines_thickness="0.07819*mm" initial_metal_striplines_thickness="0.00714*mm" 
		 final_metal_striplines_thickness="0.0138*mm" support_width="10*mm"  />
        </detector> <!--vxd-->
	
        <!-- <include "SIT_04.xml"/> -->
	
        <detector name="TPC" type="TPC10" vis="TPCVis" id="1" limits="Tracker_limits" readout="TPCCollection" insideTrackingVolume="true">
	  <!-- database : tpc10_01 -->
	  <!-- SQL command: "SELECT * FROM `global`;"  -->
	  <global TPC_pad_height="6*mm" TPC_pad_width="1*mm"  TPC_max_step_length="5*mm" dr_InnerWall="25*mm" dr_InnerServiceArea="30*mm" dr_OuterServiceArea="30*mm"
		  dr_OuterWall="60*mm" dz_Cathode="0.06*mm" dz_Readout="25*mm" dz_Endplate="100*mm"
		  chamber_Gas="TDR_gas" sensitive_threshold_eV="32*eV"  />

	  <!-- SQL command: "SELECT * FROM `cathode`;"  -->
	  <cathode dz_Cathode_Insulator="0.0275*mm" dz_Cathode_Conductor="0.0025*mm" material_Cathode_Insulator="G4_KAPTON"
		   material_Cathode_Conductor="G4_Cu" dr_Cathode_Grip="20*mm" dz_Cathode_Grip="15*mm" material_Cathode_Grip="SiC_foam"  />
	  
	  <!-- SQL command: "SELECT * FROM `innerWall`;"  -->
	  <innerWall>
	    <row dr="0.01*mm" material="G4_Al"  />
	    <row dr="0.05*mm" material="G4_KAPTON"  />
	    <row dr="0.3*mm" material="g10"  />
	    <row dr="24.22*mm" material="G4_AIR"  />
	    <row dr="0.3*mm" material="g10"  />
	    <row dr="0.05*mm" material="G4_KAPTON"  />
	    <row dr="0.07*mm" material="G4_Cu"  />
	  </innerWall>
	    <!-- SQL command: "SELECT * FROM `outerWall`;"  -->
	  <outerWall>
	    <row dr="0.07*mm" material="G4_Cu"  />
	    <row dr="0.05*mm" material="G4_KAPTON"  />
	    <row dr="0.3*mm" material="g10"  />
	    <row dr="59.22*mm" material="G4_AIR"  />
	    <row dr="0.3*mm" material="g10"  />
	    <row dr="0.05*mm" material="G4_KAPTON"  />
	    <row dr="0.01*mm" material="G4_Al"  />
	  </outerWall>
	  <!-- SQL command: "SELECT * FROM `readout`;"  -->
	  <readout>
	    <row dz="0.003*mm" material="G4_Cu" comment="gating"  />
	    <row dz="0.03*mm" material="G4_KAPTON" comment="gating"  />
	    <row dz="0.003*mm" material="G4_Cu" comment="gating"  />
	    <row dz="4.447*mm" material="TDR_gas" comment="gating"  />
	    <row dz="0.003*mm" material="G4_Cu" comment="mpgd"  />
	    <row dz="0.03*mm" material="G4_KAPTON" comment="mpgd"  />
	    <row dz="0.003*mm" material="G4_Cu" comment="mpgd"  />
	    <row dz="4.447*mm" material="TDR_gas" comment="mpgd"  />
	    <row dz="0.003*mm" material="G4_Cu" comment="mpgd"  />
	    <row dz="0.03*mm" material="G4_KAPTON" comment="mpgd"  />
	    <row dz="0.003*mm" material="G4_Cu" comment="mpgd"  />
	    <row dz="4.447*mm" material="TDR_gas" comment="mpgd"  />
	    <row dz="0.05*mm" material="G4_Cu" comment="pads"  />
	    <row dz="2*mm" material="g10" comment="structural"  />
	    <row dz="0.5*mm" material="G4_Si" comment="electronics"  />
	    <row dz="2*mm" material="epoxy" comment="structural"  />
	    <row dz="1*mm" material="G4_KAPTON" comment="structural"  />
	    <row dz="2*mm" material="G4_Al" comment="Cooling"  />
	    <row dz="1*mm" material="G4_KAPTON" comment="structural"  />
	    <row dz="3*mm" material="CarbonFiber" comment="structural"  />
	  </readout>
	</detector>

	<detector name="BeamCal" type="BeamCal" vis="BeamCalVis" id="1" readout="BeamCalCollection" insideTrackingVolume="false">
	  <parameter crossingangle="ILC_Main_Crossing_Angle" 
		     cutoutspanningangle="40*deg" 
		     incomingbeampiperadius="BCal_TubeIncomingRadius"/>

	  <dimensions inner_r = "BCal_rInner" 
		      inner_z = "LHcal_zend + LHcal_BCal_clearance" 
		      outer_r = "BCal_rOuter" />

	  <layer repeat="1" >
            <slice material = "C"         thickness = "BCal_dGraphite" vis="LayerVis1"      layerType="holeForIncomingBeampipe"/>
	  </layer>

	  <layer repeat="BCal_nLayers" >
	    <slice material = "TungstenDens24" thickness = "BCal_dAbsorber"        vis="BCLayerVis1" layerType="holeForIncomingBeampipe" />
	    <slice material = "Silicon" thickness = "0.3004*mm" sensitive = "yes"  vis="BCLayerVis2"/>
	    <slice material = "Copper"  thickness = "0.0004*mm"                    vis="BCLayerVis3"/>
	    <slice material = "Kapton"  thickness = "0.15*mm"                      vis="BCLayerVis4"/>
	    <slice material = "Air"     thickness = "0.05*mm" />
	  </layer>

	</detector>

      </detectors> 

    <readouts>
        <readout name="VXDCollection">
	  <!-- fixme: for now DD4hep cannot handle signed values - side should actually be "-2" -->
            <id>system:5,side:2,layer:9,module:8,sensor:8</id>
        </readout>
        <readout name="TPCCollection">
	  <!-- fixme: for now DD4hep cannot handle signed values - side should actually be "-2" -->
            <id>system:5,side:2,layer:9,module:8,sensor:8</id>
        </readout>

	<readout name="BeamCalCollection">
	  <segmentation type="CartesianGridXYZ" grid_size_x="0.35*cm" grid_size_y="0.35*cm"  grid_size_z="0.35*cm" gridSizeX="0.35*cm" gridSizeY="0.35*cm" gridSizeZ="0.35*cm"/>
	  <id>system:8,layer:8,barrel:3,layer:8,slice:5,x:32:-16,y:-16</id>
	</readout>
	
    </readouts>
 <fields>
   <field type="solenoid" name="GlobalSolenoid" inner_field="Field_nominal_value*tesla"
	  outer_field="-1.5*tesla" zmax="TPC_Ecal_Hcal_barrel_halfZ"
	  inner_radius="TPC_outer_radius"
	  outer_radius="world_side" />
 </fields> 
</lccdd>
